# -------------------------------------------------------------
#  HPL Makefile for AlmaLinux 9 + OpenMPI + OpenBLAS
# -------------------------------------------------------------

SHELL        = /bin/sh
CD           = cd
CP           = cp
LN_S         = ln -fs
MKDIR        = mkdir -p
RM           = /bin/rm -f
TOUCH        = touch

# -------------------------------------------------------------
# Platform identifier
# -------------------------------------------------------------
ARCH         = Linux_OpenMPI

# -------------------------------------------------------------
# HPL directory structure
# -------------------------------------------------------------
TOPdir       = /home/hpcuser/hpl-2.3
INCdir       = $(TOPdir)/include
BINdir       = $(TOPdir)/bin/$(ARCH)
LIBdir       = $(TOPdir)/lib/$(ARCH)

HPLlib       = $(LIBdir)/libhpl.a

# -------------------------------------------------------------
# MPI configuration
# -------------------------------------------------------------
MPinc        =
MPlib        =

# -------------------------------------------------------------
# OpenBLAS configuration
# -------------------------------------------------------------
LAinc        =
LAlib        = -lopenblas

# -------------------------------------------------------------
# Fortran-to-C interface (OpenBLAS expects this)
# -------------------------------------------------------------
F2CDEFS      = -DAdd_ -DF77_INTEGER=int -DStringSunStyle

# -------------------------------------------------------------
# HPL includes and libraries
# -------------------------------------------------------------
HPL_INCLUDES = -I$(INCdir) -I$(INCdir)/$(ARCH) $(LAinc) $(MPinc)
HPL_LIBS     = $(HPLlib) $(LAlib) $(MPlib)

# -------------------------------------------------------------
# Compile-time options
# -------------------------------------------------------------
HPL_OPTS     = -DHPL_DETAILED_TIMING

HPL_DEFS     = $(F2CDEFS) $(HPL_OPTS) $(HPL_INCLUDES)

# -------------------------------------------------------------
# Compiler and linker
# -------------------------------------------------------------
CC           = mpicc
CCNOOPT      = $(HPL_DEFS)
CCFLAGS      = $(HPL_DEFS) -O3 -march=native -fomit-frame-pointer -Wall

LINKER       = mpicc
LINKFLAGS    = $(CCFLAGS)

ARCHIVER     = ar
ARFLAGS      = r
RANLIB       = echo

